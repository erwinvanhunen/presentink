<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>PresentInk Settings</title>

  <style>
    body {
      background: #ffffff;
      font-family: -apple-system, BlinkMacSystemFont, "San Francisco", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .settings-container {
      background: rgba(255, 255, 255, 0.8);
      min-width: 500px;
    }

    .settings-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 20px;
    }

    .settings-label {
      font-size: 15px;
      color: #333;
      padding-right: 16px;
      vertical-align: middle;
      white-space: nowrap;
    }

    .settings-control {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    input[type=range] {
      -webkit-appearance: none;
      width: 220px;
      height: 4px;
      background: #d0d0d0;
      border-radius: 2px;
      outline: none;
      transition: background 0.2s;
    }

    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.25);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
      transition: transform 0.1s;
    }

    input[type=range]::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }

    .value-label {
      font-size: 13px;
      color: #666;
      min-width: 40px;
    }

    canvas.dot-preview,
    canvas.arrow-preview {
      /* border: 1px solid #ccc; */
      background: #f9f9f9;
      border-radius: 8px;
    }

    input[type=checkbox] {
      width: 18px;
      height: 18px;
      accent-color: #007aff;
      /* macOS blue */
    }
  </style>
</head>

<body>
  <div class="settings-container">
    <form id="settingsForm" autocomplete="off">
      <table class="settings-table">
        <tr>
          <td class="settings-label">Pen width</td>
          <td class="settings-control">
            <input id="penWidth" type="range" min="1" max="24" value="6">
            <span class="value-label" id="penWidthValue">3 px</span>
            <canvas class="dot-preview" id="dotPreview" width="72" height="40"></span>
          </td>
        </tr>
        <tr>
          <td class="settings-label">Arrowhead length</td>
          <td class="settings-control">
            <input id="arrowHead" type="range" min="8" max="40" value="20">
            <span class="value-label" id="arrowHeadValue">20 px</span>
            <canvas class="arrow-preview" id="arrowPreview" width="72" height="40"></canvas>
          </td>
        </tr>
        <tr>
          <td class="settings-label">Break timer length</td>
          <td class="settings-control">
            <input id="breakTime" type="range" min="1" max="60" value="10">
            <span class="value-label" id="breakTimeValue">10 min</span>
          </td>
        </tr>
        <tr>
          <td class="settings-label"><label for="launchAtLogin">Launch at login</label></td>
          <td class="settings-control">
            <input type="checkbox" id="launchAtLogin" name="launchAtLogin">
          </td>
        </tr>
        <tr>
          <td class="settings-label"> <label for="showExperimental">Show experimental features</label></td>
          <td class="settings-control">
            <input type="checkbox" id="showExperimental" name="showExperimental">
          </td>
        </tr>
      </table>
    </form>
  </div>
  <script>
    // Pen width preview
    const penWidthCanvas = document.getElementById('dotPreview');
    const penWidthCtx = penWidthCanvas.getContext('2d');
    const arrowCanvas = document.getElementById('arrowPreview');
    const arrowCtx = arrowCanvas.getContext('2d');

    const penWidth = document.getElementById('penWidth');
    const penWidthValue = document.getElementById('penWidthValue');
    const breakTime = document.getElementById('breakTime');
    const breakTimeValue = document.getElementById('breakTimeValue');
    const arrowHead = document.getElementById('arrowHead');
    const arrowHeadValue = document.getElementById('arrowHeadValue');
    const launchAtLogin = document.getElementById('launchAtLogin');
    const showExperimental = document.getElementById('showExperimental');
    arrowHead.oninput = () => {
      arrowHeadValue.textContent = arrowHead.value;
      drawArrow(arrowCtx, 0, arrowCanvas.height / 2, arrowCanvas.width, arrowCanvas.height / 2, penWidth.value, arrowHead.value);
      saveSettings();
    };

    breakTime.oninput = () => {
      breakTimeValue.textContent = `${breakTime.value} min`;
      saveSettings();
    };
    // Initial draw for pen width and arrow


    penWidth.oninput = () => {
      penWidthValue.textContent = penWidth.value;
      drawPenWidth(penWidth.value);
      drawArrow(arrowCtx, 0, arrowCanvas.height / 2, arrowCanvas.width, arrowCanvas.height / 2, penWidth.value, arrowHead.value);
      saveSettings();
    };

    launchAtLogin.onchange = () => {
      saveSettings();
      window.electronAPI.setLaunchAtLogin(launchAtLogin.checked);
    };

    showExperimental.onchange = () => {
      saveSettings();
      window.electronAPI.setShowExperimentalFeatures(showExperimental.checked);
    };

    function saveSettings() {
      // This function can be used to save settings immediately if needed
      // For example, you can call it on pen width change
      window.electronAPI.saveSettings({
        breakTime: breakTime.value,
        penWidth: penWidth.value,
        arrowHead: arrowHead.value,
        launchOnStartup: document.getElementById('launchAtLogin').checked,
        showExperimentalFeatures: document.getElementById('showExperimental').checked
      });
    }

    // Load existing settings on open (if you use IPC)
    if (window.electronAPI && window.electronAPI.getSettings) {

      window.electronAPI.getSettings().then(s => {
        document.getElementById('breakTime').value = s.breakTime || '10';
        document.getElementById('breakTimeValue').textContent = `${s.breakTime} min` || '10 min';
        document.getElementById('penWidth').value = s.penWidth || '3';
        document.getElementById('penWidthValue').textContent = s.penWidth || '3';
        drawPenWidth(s.penWidth || 3);
        drawArrow(arrowCtx, 0, arrowCanvas.height / 2, arrowCanvas.width, arrowCanvas.height / 2, s.penWidth || 3, s.arrowHead || 20);
        document.getElementById('arrowHead').value = s.arrowHead || '20';
        document.getElementById('arrowHeadValue').textContent = s.arrowHead || '20';
        document.getElementById('launchAtLogin').checked = s.launchOnStartup || false;
        document.getElementById('showExperimental').checked = s.showExperimentalFeatures || false;
      });
    }

    function drawPenWidth(width) {
      penWidthCtx.clearRect(0, 0, penWidthCanvas.width, penWidthCanvas.height);
      penWidthCtx.lineWidth = width;
      penWidthCtx.strokeStyle = '#ff0000'; // Example color
      penWidthCtx.moveTo(0, penWidthCanvas.height / 2);
      penWidthCtx.lineTo(penWidthCanvas.width, penWidthCanvas.height / 2);
      penWidthCtx.stroke();
    }

    function drawArrow(ctx, fromX, fromY, toX, toY, penWidth, arrowHeadLength) {
      ctx.clearRect(0, 0, arrowCanvas.width, arrowCanvas.height);
      const headlen = arrowHeadLength; // Arrowhead length
      const dx = toX - fromX;
      const dy = toY - fromY;
      const angle = Math.atan2(dy, dx);

      // Calculate endpoint of the shaft (before the arrowhead starts)
      const shaftX = toX - (headlen - 2) * Math.cos(angle);
      const shaftY = toY - (headlen - 2) * Math.sin(angle);

      // Draw shaft
      ctx.strokeStyle = "#ff0000"; // Use the selected stroke color
      ctx.lineWidth = penWidth;
      ctx.lineCap = 'flat'; // Flat line cap for better arrow appearance
      ctx.beginPath();
      ctx.moveTo(fromX, fromY);
      ctx.lineTo(shaftX, shaftY);
      ctx.stroke();

      // Draw filled arrowhead 
      const arrowX1 = toX - headlen * Math.cos(angle - Math.PI / 7);
      const arrowY1 = toY - headlen * Math.sin(angle - Math.PI / 7);

      const arrowX2 = toX - headlen * Math.cos(angle + Math.PI / 7);
      const arrowY2 = toY - headlen * Math.sin(angle + Math.PI / 7);

      ctx.beginPath();
      ctx.moveTo(toX, toY);
      ctx.lineTo(arrowX1, arrowY1);
      ctx.lineTo(arrowX2, arrowY2);
      ctx.closePath();
      ctx.fillStyle = "#ff0000"; // Use the selected fill color
      ctx.fill();
    }
  </script>
</body>

</html>