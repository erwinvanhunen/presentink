<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>PresentInk Settings</title>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: #fff;
      color: #222;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
    }

    .settings-container {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
      min-width: 430px;
      max-width: 560px;
      margin: 0 auto;
      padding: 32px 24px 24px 24px;
    }

    h2 {
      font-size: 1.52em;
      font-weight: 600;
      margin-top: 0;
      margin-bottom: 18px;
      color: #27305a;
      letter-spacing: 0.01em;
      text-align: left;
    }

    .settings-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 14px;
    }

    .settings-table td {
      vertical-align: middle;
      padding: 0 0 0 0;
      min-height: 48px;
    }

    .settings-table tr {
      min-height: 48px;
    }

    .settings-label {
      font-size: 1.09em;
      font-weight: 500;
      color: #333;
      text-align: right;
      width: 40%;
      padding-right: 18px;
      user-select: none;
    }

    .settings-control {
      text-align: left;
      width: 60%;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    input[type="color"] {
      border: none;
      width: 32px;
      height: 32px;
      background: none;
      border-radius: 6px;
      box-shadow: 0 1px 3px #0001;
      cursor: pointer;
    }

    input[type="range"] {
      accent-color: #567af7;
      margin-right: 8px;
    }

    .value-label {
      color: #888;
      min-width: 36px;
      font-variant-numeric: tabular-nums;
      display: inline-block;
      font-size: 1em;
      font-weight: 400;
    }

    .dot-preview {
      display: inline-block;
      vertical-align: middle;

      margin-left: 8px;
      height: 40px;
      width: 72px;

    }

    .arrow-preview {
      display: inline-block;
      vertical-align: middle;
      width: 72px;
      height: 40px;
      margin-left: 8px;
      margin-bottom: 2px;
    }

    .section-title {
      font-size: 1em;
      font-weight: 600;
      color: #8a8b97;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      margin: 18px 0 5px 0;
      grid-column: span 2;
      padding-top: 6px;
      padding-bottom: 2px;
    }

    .footer {
      text-align: right;
      margin-top: 28px;
    }

    button {
      font-size: 1.08em;
      background: #f0f2fa;
      border: none;
      padding: 9px 24px;
      border-radius: 8px;
      color: #1d263b;
      cursor: pointer;
      font-weight: 500;
      box-shadow: 0 2px 6px #0001;
      transition: background 0.18s;
    }

    button:active {
      background: #e5e7ef;
    }

    .macos-upload-label {
      display: inline-block;
      padding: 7px 22px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      font-size: 1.06em;
      color: #232323;
      background: #f5f6fa;
      border-radius: 7px;
      border: 1px solid #dadbe3;
      box-shadow: 0 2px 6px rgba(80, 80, 80, 0.05);
      cursor: pointer;
      transition: background 0.15s, box-shadow 0.15s;
      margin-right: 12px;
    }

    .macos-upload-label:hover {
      background: #e9eaf0;
      box-shadow: 0 3px 10px rgba(80, 80, 80, 0.10);
    }

    .macos-upload-label:active {
      background: #d6d7dc;
    }

    #scriptFileInput {
      display: none;
    }
  </style>
</head>
<body>
  <div class="settings-container">
    <form id="settingsForm" autocomplete="off">
      <table class="settings-table">
        <tr>
          <td class="settings-label">Pen width</td>
          <td class="settings-control">
            <input id="penWidth" type="range" min="1" max="24" value="6">
            <span class="value-label" id="penWidthValue">3 px</span>
            <canvas class="dot-preview" id="dotPreview" width="72" height="40"></span>
          </td>
        </tr>
        <tr>
          <td class="settings-label">Arrowhead length</td>
          <td class="settings-control">
            <input id="arrowHead" type="range" min="8" max="40" value="20">
            <span class="value-label" id="arrowHeadValue">20 px</span>
            <canvas class="arrow-preview" id="arrowPreview" width="72" height="40"></canvas>
          </td>
        </tr>
        <tr>
          <td class="settings-label">Break timer length</td>
          <td class="settings-control">
            <input id="breakTime" type="range" min="1" max="30" value="10">
            <span class="value-label" id="breakTimeValue">10 min</span>
          </td>
        </tr>
      </table>
      <div class="footer">
        <button type="submit" id="saveBtn">Save</button>
      </div>
    </form>
  </div>
  <script>
    // Pen width preview
    const penWidthCanvas = document.getElementById('dotPreview');
    const penWidthCtx = penWidthCanvas.getContext('2d');
    const arrowCanvas = document.getElementById('arrowPreview');
    const arrowCtx = arrowCanvas.getContext('2d');

    const penWidth = document.getElementById('penWidth');
    const penWidthValue = document.getElementById('penWidthValue');
    const breakTime = document.getElementById('breakTime');
    const breakTimeValue = document.getElementById('breakTimeValue');
    const arrowHead = document.getElementById('arrowHead');
    const arrowHeadValue = document.getElementById('arrowHeadValue');

    arrowHead.oninput = () => {
      arrowHeadValue.textContent = arrowHead.value;
      drawArrow(arrowCtx, 0, arrowCanvas.height / 2, arrowCanvas.width, arrowCanvas.height / 2, penWidth.value, arrowHead.value);
    };

    breakTime.oninput = () => { breakTimeValue.textContent = breakTime.value; };


    penWidth.oninput = () => {
      penWidthValue.textContent = penWidth.value;
      drawPenWidth(penWidth.value);
      drawArrow(arrowCtx, 0, arrowCanvas.height / 2, arrowCanvas.width, arrowCanvas.height / 2, penWidth.value, arrowHead.value);
    };

    // Save action
    document.getElementById('saveBtn').onclick = () => {
      window.electronAPI.saveSettings({
        breakTime: document.getElementById('breakTime').value,
        penWidth: document.getElementById('penWidth').value,
        arrowHead: document.getElementById('arrowHead').value,
      });
      window.close();
    };

    // Load existing settings on open (if you use IPC)
    if (window.electronAPI && window.electronAPI.getSettings) {
      window.electronAPI.getSettings().then(s => {
        document.getElementById('breakTime').value = s.breakTime || '10';
        document.getElementById('breakTimeValue').textContent = s.breakTime || '10';
        document.getElementById('penWidth').value = s.penWidth || '3';
        document.getElementById('penWidthValue').textContent = s.penWidth || '3';
        drawPenWidth(s.penWidth || 3);
        drawArrow(arrowCtx, 0, arrowCanvas.height / 2, arrowCanvas.width, arrowCanvas.height / 2, s.penWidth || 3, s.arrowHead || 20);
        document.getElementById('arrowHead').value = s.arrowHead || '20';
        document.getElementById('arrowHeadValue').textContent = s.arrowHead || '20';
      });
    }

    function drawPenWidth(width) {
      penWidthCtx.clearRect(0, 0, penWidthCanvas.width, penWidthCanvas.height);
      penWidthCtx.lineWidth = width;
      penWidthCtx.strokeStyle = '#ff0000'; // Example color
      penWidthCtx.moveTo(0, penWidthCanvas.height / 2);
      penWidthCtx.lineTo(penWidthCanvas.width, penWidthCanvas.height / 2);
      penWidthCtx.stroke();
    }

    function drawArrow(ctx, fromX, fromY, toX, toY, penWidth, arrowHeadLength) {
      ctx.clearRect(0, 0, arrowCanvas.width, arrowCanvas.height);
      const headlen = arrowHeadLength; // Arrowhead length
      const dx = toX - fromX;
      const dy = toY - fromY;
      const angle = Math.atan2(dy, dx);

      // Calculate endpoint of the shaft (before the arrowhead starts)
      const shaftX = toX - (headlen - 2) * Math.cos(angle);
      const shaftY = toY - (headlen - 2) * Math.sin(angle);

      // Draw shaft
      ctx.strokeStyle = "#ff0000"; // Use the selected stroke color
      ctx.lineWidth = penWidth;
      ctx.lineCap = 'round';
      ctx.beginPath();
      ctx.moveTo(fromX, fromY);
      ctx.lineTo(shaftX, shaftY);
      ctx.stroke();

      // Draw filled arrowhead 
      const arrowX1 = toX - headlen * Math.cos(angle - Math.PI / 7);
      const arrowY1 = toY - headlen * Math.sin(angle - Math.PI / 7);

      const arrowX2 = toX - headlen * Math.cos(angle + Math.PI / 7);
      const arrowY2 = toY - headlen * Math.sin(angle + Math.PI / 7);

      ctx.beginPath();
      ctx.moveTo(toX, toY);
      ctx.lineTo(arrowX1, arrowY1);
      ctx.lineTo(arrowX2, arrowY2);
      ctx.closePath();
      ctx.fillStyle = "#ff0000"; // Use the selected fill color
      ctx.fill();
    }
  </script>
</body>

</html>